<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>plannest - Artes</title>
  <link rel="stylesheet" href="disciplinas.css">
  <link rel="shortcut icon" href="../imagens/favicon.png" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="menu1">
    <button class="menu-toggle" aria-label="Abrir menu">&#9776;</button>
    <a href="../index.html"><img height="30px" src="../imagens/plannest.png" ></a>
  
    <nav class="links" id="nav-links">
      <ul class="nav-itens">
        <li><a href="../index.html" class="home">Início</a></li>
        <li><a href="../index.html#paginas"><span>Páginas</span></a></li>
        <li><a href="../services.html">Sugestões</a></li>
        <li><a href="../feedbeck.html">Avaliar</a></li>
        <li><a href="../contato.html">Fale conosco</a></li>
        
        <li><button class="login-li"><a class="link-login-li" href="../login.html">Login</a></button></li>
        <li><button class="cadastro-li"><a class="link-cadastro-li" href="../cadastro.html" style="color: white;">Cadastro</a></button></li>
      </ul>
    </nav>
  
    <div class="btn">
      <button class="login-1"><a class="link-login" href="../login.html">Login</a></button>
      <button class="cadastro"><a href="../cadastro.html" class="link-cadastro">Cadastro</a></button>
    </div>
  </header>
    <h1 class="tittle">
      Suas atividades de classe
    </h1>
    <div class="container">
      <div class="tab-box">
        <button class="tab-btn">Disciplinas</button>
        <button class="tab-btn">Desempenho</button>
        <div class="line">
        </div>
      </div>
      <div class="content-box">
        <div class="content">
        <section class="slide2">
          <h4 class="btn-slide2"><a href="../atividades.html"><span>Disciplinas</span></a> > <a href="artes.html" style="color: var(--cor6--);">Artes</a></h4>
          <form id="atividade-form">
            <input type="text" id="nova-atividade" placeholder="Digite uma nova atividade" required>
            <button type="submit" id="btn-atividade">Adicionar</button>
          </form>
          <ul id="lista-atividades">
          </ul>
        </section>
        </div>
        <div class="content">
          <section class="slide2">
            <h2>Desempenho de <span id="currentSubjectNameDisplay"></span></h2>
            <div class="graficos-container" style="display: flex; justify-content: center; align-items: center; min-height: 250px;">
              <div style="width: 300px; height: 300px;"><canvas id="chartCurrentSubject"></canvas></div>
            </div>
          </section>    
        </div>
      </div>
    </div>
    <br><br><br>
  <footer>
    <section class="newsletter">
    <h2>Quer organizar melhor sua rotina?</h2>
    <p>
      Inscreva-se na nossa newsletter e receba dicas exclusivas de
      planejamento e produtividade diretamente no seu e-mail:
    </p>
    <div class="newsletter-form">
      <input type="email" placeholder="Digite seu e-mail" />
      <button>Cadastrar</button>
    </div>
    </section>
    <div class="footer-content">
    <div class="footer-logo">
      <img
      height="40px"
      class="logo-footer"
      src="../imagens/plannest.png"
      alt=""
      />
      <p>
      Transforme sua rotina com ferramentas de planejamento simples e
      eficazes.
      </p>
    </div>
    <div class="footer-links">
      <div>
      <h4>Links úteis</h4>
      <ul>
        <li><a href="#">Blog</a></li>
        <li><a href="#">Sobre nós</a></li>
        <li><a href="#">Ferramentas</a></li>
      </ul>
      </div>
      <div>
      <h4>Serviços</h4>
      <ul>
        <li><a href="#">Planejamento Pessoal</a></li>
        <li><a href="#">Gestão de Tarefas</a></li>
        <li><a href="#">Calendário Online</a></li>
        <li><a href="#">Consultoria</a></li>
      </ul>
      </div>
      <div>
      <h4>Suporte</h4>
      <ul>
        <li><a href="#">Fale conosco</a></li>
        <li><a href="#">Envie um e-mail</a></li>
        <li><a href="#">Central de ajuda</a></li>
        <li><a href="#">FAQ</a></li>
      </ul>
      </div>
      <div class="social">
      <h4>Siga-nos</h4>
      <div class="icons">
        <a href="#"><img src="../imagens/instagram.png" alt="Instagram"/></a>
        <a href="#"><img src="../imagens/linkedin.png" alt="LinkedIn" /></a>
      </div>
      </div>
    </div>
    </div>
    <div class="footer-bottom">
    <p>Plannest 2025 © Todos os direitos reservados</p>
    </div>
  </footer>
  <script src="../menu-toggle.js"></script>
  <script>
    // Mapeamento das matérias e suas chaves no localStorage
    // As chaves no 'key' são como estão salvas no localStorage (sem acentos/espaços)
    // As chaves no 'displayName' são como devem aparecer no gráfico
    const materiasData = {
        'artes': { key: 'atividadesArtes', displayName: 'Artes' },
        'biologia': { key: 'atividadesBiologia', displayName: 'Biologia' },
        'edfisica': { key: 'atividadesEdFisica', displayName: 'Ed. Física' }, 
        'espanhol': { key: 'atividadesEspanhol', displayName: 'Espanhol' },
        'filosofiaesociologia': { key: 'atividadesFilosofiaSociologia', displayName: 'Filosofia e Sociologia' },
        'fisica': { key: 'atividadesFisica', displayName: 'Física' },
        'geografia': { key: 'atividadesGeografia', displayName: 'Geografia' },
        'historia': { key: 'atividadesHistoria', displayName: 'História' },
        'ingles': { key: 'atividadesIngles', displayName: 'Inglês' },
        'matematica': { key: 'atividadesMatematica', displayName: 'Matemática' },
        'portugues': { key: 'atividadesPortugues', displayName: 'Português' },
        'quimica': { key: 'atividadesQuimica', displayName: 'Química' }
    };

    let chartInstance = null; // Para armazenar a instância única do gráfico

    // Função para calcular a porcentagem de conclusão de uma matéria
    function calcularPorcentagemConclusao(materiaKey) {
        const atividades = JSON.parse(localStorage.getItem(materiaKey)) || [];
        const totalAtividades = atividades.length;
        if (totalAtividades === 0) {
            return 0; // Se não há atividades, a porcentagem é 0
        }
        const atividadesConcluidas = atividades.filter(atividade => atividade.concluida).length;
        return (atividadesConcluidas / totalAtividades) * 100;
    }

    // Função para criar ou atualizar o gráfico da matéria atual
    function criarOuAtualizarGraficoMateriaAtual(materiaNomeDisplay, materiaKey) {
        const ctx = document.getElementById('chartCurrentSubject');
        if (!ctx) {
            console.error("Canvas para o gráfico não encontrado.");
            return;
        }
        const canvasContext = ctx.getContext('2d');
        const porcentagemConcluida = calcularPorcentagemConclusao(materiaKey);
        const porcentagemPendente = 100 - porcentagemConcluida;

        // Destroi o gráfico existente se houver para recriar com novos dados
        if (chartInstance) {
            chartInstance.destroy();
        }

        chartInstance = new Chart(canvasContext, {
            type: 'doughnut', // Gráfico de donut para porcentagens
            data: {
                labels: ['Concluídas', 'Pendentes'],
                datasets: [{
                    data: [porcentagemConcluida, porcentagemPendente],
                    backgroundColor: ['#4CAF50', '#FFC107'], // Verde para concluídas, Amarelo para pendentes
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Permite controlar largura/altura via CSS
                plugins: {
                    title: {
                        display: true,
                        text: materiaNomeDisplay, // Usa o nome amigável para o título do gráfico
                        font: {
                            size: 18
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed.toFixed(2) + '%';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Função principal para renderizar o gráfico de desempenho da matéria atual
    function renderizarGraficoDesempenhoDaMateria() {
        const pageTitle = document.title; // Ex: "plannest - Artes"
        const startIndex = pageTitle.indexOf('- ') + 2; // Encontra o início do nome da matéria
        let rawSubjectNameFromTitle = pageTitle.substring(startIndex).trim(); // Pega "Artes"

        const subjectNameDisplayElement = document.getElementById('currentSubjectNameDisplay');
        
        let currentSubjectData = null;

        // Tenta encontrar a chave correta no materiasData
        // Normaliza tanto a chave do mapa quanto o nome do título para comparação (sem acentos, espaços, minúsculas)
        const normalizedRawTitleName = rawSubjectNameFromTitle.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]/g, '');

        for (const key in materiasData) {
            if (materiasData.hasOwnProperty(key)) {
                if (key === normalizedRawTitleName) {
                    currentSubjectData = materiasData[key];
                    break;
                }
            }
        }

        // Tratamento especial para "Filosofia e Sociologia" caso o título seja simplificado (ex: apenas "Filosofia")
        if (!currentSubjectData && normalizedRawTitleName.includes('filosofia')) {
            currentSubjectData = materiasData['filosofiaesociologia'];
        }

        if (currentSubjectData) {
            // Atualiza o display do nome da matéria no título da seção
            if (subjectNameDisplayElement) {
                subjectNameDisplayElement.textContent = currentSubjectData.displayName;
            }
            criarOuAtualizarGraficoMateriaAtual(currentSubjectData.displayName, currentSubjectData.key);
        } else {
            console.warn('Não foi possível encontrar dados para a matéria:', rawSubjectNameFromTitle);
            if (subjectNameDisplayElement) {
                subjectNameDisplayElement.textContent = rawSubjectNameFromTitle; // Ainda exibe o que foi lido
            }
            // Exibe mensagem no canvas se os dados não forem encontrados
            const ctx = document.getElementById('chartCurrentSubject');
            if (ctx) {
                const canvasContext = ctx.getContext('2d');
                if (chartInstance) chartInstance.destroy(); // Destroi qualquer gráfico anterior
                canvasContext.clearRect(0, 0, ctx.width, ctx.height); // Limpa o canvas
                canvasContext.font = '16px Arial';
                canvasContext.fillStyle = 'gray';
                canvasContext.textAlign = 'center';
                canvasContext.fillText('Dados de desempenho não disponíveis.', ctx.width / 2, ctx.height / 2);
            }
        }
    }

    // Funções de gerenciamento de atividades (permanecem na aba de Disciplinas)
    function carregarAtividades() {
        // Assume que 'atividadesArtes' é a chave para esta página específica
        return JSON.parse(localStorage.getItem('atividadesArtes')) || [];
    }

    function salvarAtividades(atividades) {
        localStorage.setItem('atividadesArtes', JSON.stringify(atividades));
    }

    function renderizarAtividades() {
        const lista = document.getElementById('lista-atividades');
        lista.innerHTML = '';
        const atividades = carregarAtividades();
        atividades.forEach((atividade, index) => {
            const li = document.createElement('li');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'atividade-checkbox';
            checkbox.style.marginRight = "15px";
            checkbox.checked = atividade.concluida;
            checkbox.addEventListener('change', function() {
                atividades[index].concluida = checkbox.checked;
                salvarAtividades(atividades);
                renderizarGraficoDesempenhoDaMateria(); // Atualiza o gráfico após mudança
            });
            li.appendChild(checkbox);
            const span = document.createElement('span');
            span.textContent = atividade.texto;
            li.appendChild(span);
            const btnExcluir = document.createElement('button');
            btnExcluir.textContent = 'X';
            btnExcluir.className = 'btn-excluir';
            btnExcluir.style.marginLeft = 'auto';
            btnExcluir.style.background = "transparent";
            btnExcluir.style.color = "var(--cor2--)";
            btnExcluir.style.fontWeight = "1000";
            btnExcluir.addEventListener('click', function() {
                atividades.splice(index, 1);
                salvarAtividades(atividades);
                renderizarAtividades();
                renderizarGraficoDesempenhoDaMateria(); // Atualiza o gráfico após exclusão
            });
            li.appendChild(btnExcluir);
            lista.appendChild(li);
        });
    }

    // Lógica para controle das abas e inicialização
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('atividade-form');
        const input = document.getElementById('nova-atividade');
        
        renderizarAtividades(); // Carrega as atividades da matéria atual ao carregar a página

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const texto = input.value.trim();
            if (texto) {
                const atividades = carregarAtividades();
                atividades.push({ texto: texto, concluida: false });
                salvarAtividades(atividades);
                renderizarAtividades();
                input.value = '';
                renderizarGraficoDesempenhoDaMateria(); // Atualiza o gráfico após adicionar
            }
        });

        const tabs = document.querySelectorAll('.tab-btn');
        const all_content = document.querySelectorAll('.content');

        // Função para ativar a aba inicial (Disciplinas)
        function activateInitialTab() {
            tabs[0].classList.add('active'); // Ativa o primeiro botão de aba (Disciplinas)
            all_content[0].classList.add('active'); // Ativa o primeiro conteúdo
            var line = document.querySelector('.line');
            line.style.width = tabs[0].offsetWidth + 'px';
            line.style.left = tabs[0].offsetLeft + 'px';
        }

        // Ativa a aba inicial ao carregar a página
        activateInitialTab();

        tabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                tabs.forEach(tabItem => tabItem.classList.remove('active'));
                tab.classList.add('active');

                var line = document.querySelector('.line');
                line.style.width = tab.offsetWidth + 'px';
                line.style.left = tab.offsetLeft + 'px';

                all_content.forEach(contentItem => contentItem.classList.remove('active'));
                all_content[index].classList.add('active');

                // Se a aba de Desempenho for clicada, renderiza o gráfico da matéria atual
                if (tab.textContent === 'Desempenho') {
                    renderizarGraficoDesempenhoDaMateria();
                }
            });
        });

        // Este script é do seu código original para mobile, mantido separado para não quebrar a lógica.
        const mobileTabBtns = document.querySelectorAll('.mobile-tab-btn');
        const mobileTabContents = document.querySelectorAll('.mobile-tab-content');

        mobileTabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const target = btn.getAttribute('data-tab');
                mobileTabBtns.forEach(b => b.classList.remove('active'));
                mobileTabContents.forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('mobile-tab-' + target).classList.add('active');
            });
        });
    });
  </script>
</body>
</html>